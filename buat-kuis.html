<!DOCTYPE html>
<html lang="id">
<head>
Â Â <meta charset="UTF-8" />
Â Â <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â Â <title>Buat Pertanyaan Baru â€” Petualangan Luar Angkasa</title>
Â Â <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">
Â Â <style>
Â Â Â Â :root{
Â Â Â Â Â Â --bg-space: #0f0c29;
Â Â Â Â Â Â --card-bg: rgba(255, 255, 255, 0.1);
Â Â Â Â Â Â --border-color: rgba(255, 255, 255, 0.2);
Â Â Â Â Â Â --accent1: #ff7e5f;
Â Â Â Â Â Â --accent2: #feb47b;
Â Â Â Â Â Â --accent3: #8697ff;
Â Â Â Â Â Â --accent4: #48dbfb;
Â Â Â Â Â Â --text-light: #ffffff;
Â Â Â Â Â Â --text-dark: #2c3e50;
Â Â Â Â Â Â --btn-yellow: #feca57;
Â Â Â Â }
Â Â Â Â *{box-sizing:border-box; scroll-behavior: smooth;}
Â Â Â Â body{
Â Â Â Â Â Â font-family:'Baloo 2',sans-serif;
Â Â Â Â Â Â margin:0;
Â Â Â Â Â Â background-color: var(--bg-space);
Â Â Â Â Â Â color: var(--text-light);
Â Â Â Â Â Â min-height:100vh; 
Â Â Â Â Â Â padding:20px;
Â Â Â Â Â Â overflow-x: hidden;
Â Â Â Â }
Â Â Â Â #starfield {
Â Â Â Â Â Â Â Â position: fixed;
Â Â Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â Â Â left: 0;
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â Â Â z-index: -1;
Â Â Â Â }
Â Â Â Â .wrap{max-width:900px;margin:20px auto}
Â Â Â Â header{display:flex;justify-content:space-between; align-items:center;margin-bottom:20px;flex-wrap:wrap;gap: 15px;}
Â Â Â Â .header-title{display:flex;gap:15px;align-items:center;}
Â Â Â Â .header-title .logo-icon{background:linear-gradient(45deg, var(--accent3), var(--accent4));padding:12px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,0.2);}
Â Â Â Â h1{margin:0;font-size:1.8rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3);}
Â Â Â Â .card{
Â Â Â Â Â Â Â Â background: var(--card-bg);
Â Â Â Â Â Â Â Â border: 1px solid var(--border-color);
Â Â Â Â Â Â Â Â backdrop-filter: blur(10px);
Â Â Â Â Â Â Â Â -webkit-backdrop-filter: blur(10px);
Â Â Â Â Â Â Â Â border-radius:20px;
Â Â Â Â Â Â Â Â padding:25px;
Â Â Â Â Â Â Â Â box-shadow:0 8px 32px 0 rgba(0,0,0,0.3);
Â Â Â Â Â Â Â Â margin-bottom:20px
Â Â Â Â }
Â Â Â Â label{display:block;font-weight:700;margin-bottom:8px;font-size: 1.1rem;}
Â Â Â Â input[type=text], input[type=url], input[type=number], textarea, select{
Â Â Â Â Â Â width:100%;
Â Â Â Â Â Â padding:12px 15px;
Â Â Â Â Â Â border-radius:12px;
Â Â Â Â Â Â border: 1px solid var(--border-color);
Â Â Â Â Â Â background: rgba(255,255,255,0.1);
Â Â Â Â Â Â font-size:1rem;
Â Â Â Â Â Â color: var(--text-light);
Â Â Â Â Â Â font-family: 'Baloo 2', sans-serif;
Â Â Â Â }
Â Â Â Â textarea{min-height:80px;resize:vertical}
Â Â Â Â select { appearance: none; -webkit-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 15px center; background-size: .65em auto; padding-right: 2em; }
Â Â Â Â input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.5); }
Â Â Â Â .grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
Â Â Â Â .btn{display:inline-block;padding:12px 20px;border-radius:14px;border:none;font-weight:800;cursor:pointer;font-size:1rem; text-decoration: none; text-align: center; transition: all 0.3s ease;}
Â Â Â Â .btn-submit{background:linear-gradient(45deg, var(--accent1), var(--accent2)); color:white; box-shadow: 0 4px 15px rgba(0,0,0,0.2);}
Â Â Â Â .btn-submit:disabled { background: #555; cursor: not-allowed; box-shadow: none; }
Â Â Â Â .btn-submit:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(254, 180, 123, 0.4); }
Â Â Â Â .btn-neutral{background:rgba(255,255,255,0.15); color:white;}
Â Â Â Â .btn-ghost { background: transparent; border: 2px dashed var(--border-color); color: white; }
Â Â Â Â .section-title{font-weight:800;font-size: 1.4rem; margin-bottom:15px; border-left: 4px solid var(--accent4); padding-left: 10px;}
Â Â Â Â .submit-row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:20px;flex-wrap:wrap}
Â Â Â Â .file-attach-area { border: 2px dashed var(--border-color); border-radius: 12px; padding: 15px; text-align: center; }
Â Â Â Â input[type=file] { display: none; }
Â Â Â Â .file-label { cursor: pointer; background: var(--accent3); color: white; padding: 10px 15px; border-radius: 10px; display: inline-block; }
Â Â Â Â .file-name { margin-top: 10px; font-size: 0.9rem; color: rgba(255,255,255,0.7); }
Â Â Â Â .answer-card { padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 10px; position: relative; }
Â Â Â Â .btn-remove-choice { position: absolute; top: 10px; right: 10px; color: var(--accent1); font-size: 1.8rem; background: none; border: none; cursor: pointer; z-index: 5;}
Â Â Â Â .pg-image-preview { width: 60px; height: 60px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top: 10px; background-size: cover; background-position: center; }
Â Â Â Â .choice-row { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-start; }
Â Â Â Â .choice-main { display: flex; gap: 15px; align-items: flex-start; flex: 3 1 300px; }
Â Â Â Â .choice-media { flex: 1 1 150px; text-align: center; }

Â Â Â Â .fab-home {
Â Â Â Â Â Â Â Â position: fixed;
Â Â Â Â Â Â Â Â bottom: 30px;
Â Â Â Â Â Â Â Â right: 30px;
Â Â Â Â Â Â Â Â width: 60px;
Â Â Â Â Â Â Â Â height: 60px;
Â Â Â Â Â Â Â Â background-color: var(--btn-yellow);
Â Â Â Â Â Â Â Â color: var(--text-dark);
Â Â Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â Â Â font-size: 1.8rem;
Â Â Â Â Â Â Â Â text-decoration: none;
Â Â Â Â Â Â Â Â box-shadow: 0 5px 15px rgba(0,0,0,0.3);
Â Â Â Â Â Â Â Â z-index: 1000;
Â Â Â Â Â Â Â Â transition: transform 0.3s ease;
Â Â Â Â }
Â Â Â Â .fab-home:hover { transform: scale(1.1); }

Â Â Â Â @media(max-width:780px){.grid{grid-template-columns:1fr}.right-column{order:-1}}
Â Â Â Â .message{padding:12px;border-radius:12px;margin-top:15px;font-weight:700;font-size:1rem;}
Â Â Â Â .message.success{background:rgba(46, 204, 113, 0.8);color:white}
Â Â Â Â .message.error{background:rgba(231, 76, 60, 0.8);color:white}
Â Â Â Â .preview-media{border-radius:12px;min-height:48px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.2);}
Â Â Â Â .note { font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-bottom: 15px; }
Â Â </style>
</head>
<body>
Â Â <canvas id="starfield"></canvas>

Â Â <div class="wrap">
Â Â Â Â <header>
Â Â Â Â Â Â <div class="header-title">
Â Â Â Â Â Â Â Â <div class="logo-icon">
Â Â Â Â Â Â Â Â Â Â Â Â <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="white"/></svg>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â <h1>Buat Soal Kuis</h1>
Â Â Â Â Â Â </div>
Â Â Â Â </header>
Â Â Â Â 
Â Â Â Â <div class="grid">
Â Â Â Â Â Â <main>
Â Â Â Â Â Â Â Â <form id="question-form" class="card" autocomplete="off">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="section-title">Informasi Soal</div>
Â Â Â Â Â Â Â Â Â Â Â Â <label for="pertanyaan-teks">Tulis Pertanyaan</label>
Â Â Â Â Â Â Â Â Â Â Â Â <textarea id="pertanyaan-teks" placeholder="Contoh: Planet manakah yang paling dekat dengan Matahari?"></textarea>
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â <div style="display:flex; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div style="flex:1; min-width: 200px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label for="kategori-pilihan">Kategori Mata Pelajaran</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <select id="kategori-pilihan">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="">-- Pilih Mata Pelajaran --</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="matematika">Matematika</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="bahasa_indonesia">Bahasa Indonesia</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="bahasa_inggris">Bahasa Inggris</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="ipa">Ilmu Pengetahuan Alam</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="agama_islam">Agama Islam</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="ips">Ilmu Sosial</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="sejarah">Sejarah</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="pkn">Kewarganegaraan</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="basa_sunda">Basa Sunda</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="olahraga">Olahraga</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="seni">Seni</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="campuran_seru">Campuran Seru</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </select>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div style="flex:1; min-width: 200px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label for="tipe-soal">Tipe Soal</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <select id="tipe-soal">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="pilihan_ganda">Pilihan Ganda</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="esai">Esai</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="pencocokan">Pencocokan</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="susun_kata">Susun Kata</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="multi_benar">Beberapa Jawaban Benar</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="benar_salah">Benar / Salah</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="tts_mini">TTS Mini</option>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </select>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â <hr style="border:none; height:1px; background: var(--border-color); margin: 30px 0;">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="section-title">Media Pertanyaan (Opsional)</div>
Â Â Â Â Â Â Â Â Â Â Â Â <div style="display:flex; gap: 20px; flex-wrap: wrap;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div style="flex:1; min-width: 200px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label>Attach Gambar</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="file-attach-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label for="file-image" class="file-label">Pilih Gambar</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="file-image" accept="image/*">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="file-name" id="file-image-name">Belum ada file dipilih</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div style="flex:1; min-width: 200px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label>Attach Audio</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="file-attach-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <label for="file-audio" class="file-label">Pilih Audio</label>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="file-audio" accept="audio/*">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="file-name" id="file-audio-name">Belum ada file dipilih</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <hr style="border:none; height:1px; background: var(--border-color); margin: 30px 0;">

Â Â Â Â Â Â Â Â Â Â Â Â <div id="dynamic-area"></div>

Â Â Â Â Â Â Â Â Â Â Â Â <div class="submit-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" id="btn-preview" class="btn btn-neutral">Pratinjau</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" id="btn-reset" class="btn btn-neutral" style="margin-right: 10px;">Reset</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit" id="btn-save" class="btn btn-submit">Simpan Pertanyaan</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â <div id="form-message" class="message" style="display:none"></div>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â Â Â </main>

Â Â Â Â Â Â <aside class="right-column">
Â Â Â Â Â Â Â Â <div class="card">
Â Â Â Â Â Â Â Â Â Â <div class="section-title">Status</div>
Â Â Â Â Â Â Â Â Â Â <div id="quota-display" style="font-weight:bold; margin-bottom:15px; color: var(--accent4);">Memeriksa kuota...</div>
Â Â Â Â Â Â Â Â Â Â <hr style="border-color: var(--border-color); margin-bottom: 15px;">
Â Â Â Â Â Â Â Â Â Â <div class="section-title">Panduan</div>
Â Â Â Â Â Â Â Â Â Â <div id="guide-text" class="note" style="line-height: 1.6;">Panduan akan muncul di sini sesuai tipe soal.</div>
Â Â Â Â Â Â Â Â Â Â <hr style="border-color: var(--border-color); margin: 15px 0;">
Â Â Â Â Â Â Â Â Â Â <div class="section-title">Preview Media</div>
Â Â Â Â Â Â Â Â Â Â <div id="preview-media" class="preview-media">Tidak ada media</div>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </aside>
Â Â Â Â </div>
Â Â </div>
Â Â 
Â Â <a href="index.html" class="fab-home">ğŸ </a>

<script type="module">
Â Â Â Â import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
Â Â Â Â import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
Â Â Â Â import { getFirestore, collection, doc, Timestamp, writeBatch, getDoc, getDocs, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

Â Â Â Â // --- Canvas Starfield Animation ---
Â Â Â Â const canvas = document.getElementById('starfield');
Â Â Â Â const ctx = canvas.getContext('2d');
Â Â Â Â canvas.width = window.innerWidth;
Â Â Â Â canvas.height = window.innerHeight;
Â Â Â Â let stars = []; for (let i = 0; i < 200; i++) { stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: Math.random() * 1.5, vx: Math.floor(Math.random() * 50) - 25, vy: Math.floor(Math.random() * 50) - 25 }); }
Â Â Â Â function drawStars() { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.globalCompositeOperation = "lighter"; for (let i = 0, x = stars.length; i < x; i++) { let s = stars[i]; ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(s.x, s.y, s.radius, 0, 2 * Math.PI); ctx.fill(); } }
Â Â Â Â function updateStars() { for (let i = 0, x = stars.length; i < x; i++) { let s = stars[i]; s.x += s.vx / 60; s.y += s.vy / 60; if (s.x < 0 || s.x > canvas.width) s.vx = -s.vx; if (s.y < 0 || s.y > canvas.height) s.vy = -s.vy; } }
Â Â Â Â function tick() { drawStars(); updateStars(); requestAnimationFrame(tick); }
Â Â Â Â tick();
Â Â Â Â window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });

Â Â Â Â // --- Firebase and DOM Setup ---
Â Â Â Â const firebaseConfig = { apiKey: "AIzaSyA6zXOerKvdPJTmBp5Y6R2yFsy98xLDsKc", authDomain: "forumwidara.firebaseapp.com", projectId: "forumwidara", storageBucket: "forumwidara.appspot.com", messagingSenderId: "216895655168", appId: "1:216895655168:web:59255f600fc3b3b44eb7e5" };
Â Â Â Â const app = initializeApp(firebaseConfig);
Â Â Â Â const auth = getAuth(app);
Â Â Â Â const db = getFirestore(app);

Â Â Â Â const tipeSoal = document.getElementById('tipe-soal');
Â Â Â Â const dynamicArea = document.getElementById('dynamic-area');
Â Â Â Â const btnSave = document.getElementById('btn-save');
Â Â Â Â const formMessage = document.getElementById('form-message');
Â Â Â Â const quotaDisplay = document.getElementById('quota-display');
Â Â Â Â const guideText = document.getElementById('guide-text');
Â Â Â Â 
Â Â Â Â let currentUser = null;
Â Â Â Â let userProfile = null;
Â Â Â Â let pendingUploads = { questionImage: null, questionAudio: null, optionImages: {} };
Â Â Â Â const QUESTION_LIMIT = 5;
Â Â Â Â 
Â Â Â Â // --- File Input Handlers ---
Â Â Â Â function setupFileInput(inputId, nameDisplayId) {
Â Â Â Â Â Â Â Â const input = document.getElementById(inputId);
Â Â Â Â Â Â Â Â const nameDisplay = document.getElementById(nameDisplayId);
Â Â Â Â Â Â Â Â input.addEventListener('change', () => {
Â Â Â Â Â Â Â Â Â Â Â Â if (input.files.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const file = input.files[0];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â nameDisplay.textContent = file.name;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (inputId === 'file-image') pendingUploads.questionImage = file;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (inputId === 'file-audio') pendingUploads.questionAudio = file;
Â Â Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â nameDisplay.textContent = 'Belum ada file dipilih';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (inputId === 'file-image') pendingUploads.questionImage = null;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (inputId === 'file-audio') pendingUploads.questionAudio = null;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â });
Â Â Â Â }
Â Â Â Â setupFileInput('file-image', 'file-image-name');
Â Â Â Â setupFileInput('file-audio', 'file-audio-name');

Â Â Â Â // --- Helper Functions ---
Â Â Â Â function showFormMessage(type, text, isPermanent = false) { formMessage.className = 'message ' + (type === 'ok' ? 'success' : 'error'); formMessage.textContent = text; formMessage.style.display = 'block'; if (!isPermanent) { setTimeout(() => formMessage.style.display = 'none', 5000); } }
Â Â Â Â 
Â Â Â Â async function uploadToCloudinary(file, resourceType='image'){
Â Â Â Â Â Â const CLOUDINARY_CLOUD_NAME = "ganti-dengan-cloud-name-anda"; 
Â Â Â Â Â Â const CLOUDINARY_UPLOAD_PRESET = "ganti-dengan-upload-preset-anda";
Â Â Â Â Â Â if (CLOUDINARY_CLOUD_NAME === "ganti-dengan-cloud-name-anda") { throw new Error('Konfigurasi Cloudinary belum diatur.'); }
Â Â Â Â Â Â const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/${resourceType}/upload`;
Â Â Â Â Â Â const fd = new FormData();
Â Â Â Â Â Â fd.append('file', file);
Â Â Â Â Â Â if(CLOUDINARY_UPLOAD_PRESET !== "ganti-dengan-upload-preset-anda") { fd.append('upload_preset', CLOUDINARY_UPLOAD_PRESET); }
Â Â Â Â Â Â const res = await fetch(url, { method:'POST', body:fd });
Â Â Â Â Â Â if(!res.ok) throw new Error(`Upload gagal: ${res.statusText}`);
Â Â Â Â Â Â const j = await res.json();
Â Â Â Â Â Â return j.secure_url || j.url;
Â Â Â Â }
Â Â Â Â 
Â Â Â Â // --- PERUBAHAN 1: Fungsi baru untuk mencari persilangan TTS ---
Â Â Â Â function findIntersection(word1, word2) {
Â Â Â Â Â Â Â Â const w1 = word1.toUpperCase();
Â Â Â Â Â Â Â Â const w2 = word2.toUpperCase();
Â Â Â Â Â Â Â Â for (let i = 0; i < w1.length; i++) {
Â Â Â Â Â Â Â Â Â Â Â Â for (let j = 0; j < w2.length; j++) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (w1[i] === w2[j]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Huruf yang sama ditemukan, kembalikan posisinya
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return { mendatarIndex: i, menurunIndex: j };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â // Jika loop selesai tanpa menemukan huruf yang sama
Â Â Â Â Â Â Â Â return null;
Â Â Â Â }

Â Â Â Â function updateGuide(type) {
Â Â Â Â Â Â Â Â const guides = {
Â Â Â Â Â Â Â Â Â Â Â Â pilihan_ganda: "Pilih satu jawaban yang benar. Anda bisa menambahkan 2-4 pilihan, masing-masing bisa dengan gambar.",
Â Â Â Â Â Â Â Â Â Â Â Â esai: "Pisahkan variasi jawaban yang diterima dengan tanda ||. Contoh: Soekarno || Ir. Soekarno.",
Â Â Â Â Â Â Â Â Â Â Â Â pencocokan: "Buat pasangan antara kolom kiri dan kanan. Contoh: Ibu Kota -> Jakarta.",
Â Â Â Â Â Â Â Â Â Â Â Â susun_kata: "Tuliskan kalimat yang benar. Kata-kata akan diacak saat ditampilkan ke siswa.",
Â Â Â Â Â Â Â Â Â Â Â Â multi_benar: "Siswa bisa memilih lebih dari satu jawaban. Centang semua jawaban yang dianggap benar.",
Â Â Â Â Â Â Â Â Â Â Â Â benar_salah: "Tentukan apakah pernyataan pada soal itu Benar atau Salah.",
Â Â Â Â Â Â Â Â Â Â Â Â // --- PERUBAHAN 2: Panduan untuk TTS Mini diperbarui ---
Â Â Â Â Â Â Â Â Â Â Â Â tts_mini: "Isi jawaban mendatar dan menurun. Sistem akan otomatis menemukan huruf persilangan. Pastikan kedua kata memiliki minimal satu huruf yang sama."
Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â guideText.innerHTML = guides[type] || "Pilih tipe soal untuk melihat panduan.";
Â Â Â Â }

Â Â Â Â // --- Dynamic Form Rendering ---
Â Â Â Â function createChoiceRow(index, isChecked = false) { /* ... no change ... */ }
Â Â Â Â function renderPilihanGanda() { /* ... no change ... */ }
Â Â Â Â function renderEsai() { /* ... no change ... */ }
Â Â Â Â function renderPencocokan() { /* ... no change ... */ }
Â Â Â Â function renderSusunKata() { /* ... no change ... */ }
Â Â Â Â function renderMultiBenar() { /* ... no change ... */ }
Â Â Â Â function renderBenarSalah() { /* ... no change ... */ }

Â Â Â Â // --- PERUBAHAN 3: Form TTS Mini disederhanakan ---
Â Â Â Â function renderTtsMini() { 
Â Â Â Â Â Â dynamicArea.innerHTML = `
Â Â Â Â Â Â Â Â <div class="section-title">TTS Mini</div>
Â Â Â Â Â Â Â Â <div class="answer-card">
Â Â Â Â Â Â Â Â Â Â <label>Jawaban Mendatar</label>
Â Â Â Â Â Â Â Â Â Â <input id="tts-mendatar" placeholder="Contoh: BOLA">
Â Â Â Â Â Â Â Â Â Â <label style="margin-top:10px">Jawaban Menurun</label>
Â Â Â Â Â Â Â Â Â Â <input id="tts-menurun" placeholder="Contoh: KOTAK">
Â Â Â Â Â Â Â Â Â Â <!-- Kolom input index dihapus dari sini -->
Â Â Â Â Â Â Â Â Â Â <label style="margin-top:10px">Alasan</label>
Â Â Â Â Â Â Â Â Â Â <textarea id="tts-reason" placeholder="Alasan umum jika jawaban benar"></textarea>
Â Â Â Â Â Â Â Â </div>`; 
Â Â Â Â }

Â Â Â Â function renderDynamic() {
Â Â Â Â Â Â const t = tipeSoal.value;
Â Â Â Â Â Â updateGuide(t);
Â Â Â Â Â Â pendingUploads.optionImages = {}; 
Â Â Â Â Â Â if (t === 'pilihan_ganda') renderPilihanGanda();
Â Â Â Â Â Â else if (t === 'esai') renderEsai();
Â Â Â Â Â Â else if (t === 'pencocokan') renderPencocokan();
Â Â Â Â Â Â else if (t === 'susun_kata') renderSusunKata();
Â Â Â Â Â Â else if (t === 'multi_benar') renderMultiBenar();
Â Â Â Â Â Â else if (t === 'benar_salah') renderBenarSalah();
Â Â Â Â Â Â else if (t === 'tts_mini') renderTtsMini();
Â Â Â Â }
Â Â Â Â 
Â Â Â Â // Dynamic event listeners
Â Â Â Â dynamicArea.addEventListener('click', (e) => { /* ... no change ... */ });
Â Â Â Â dynamicArea.addEventListener('change', (e) => { /* ... no change ... */ });
Â Â Â Â 
Â Â Â Â // --- Auth, Profile & Quota Check ---
Â Â Â Â async function checkQuestionQuota(uid) { /* ... no change ... */ }
Â Â Â Â async function checkUserData(user) { /* ... no change ... */ }
Â Â Â Â onAuthStateChanged(auth, async (user) => { if(user) await checkUserData(user); else window.location.href='index.html'; });

Â Â Â Â // --- Form Submit Logic ---
Â Â Â Â document.getElementById('question-form').addEventListener('submit', async (e) => {
Â Â Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â Â Â if(!currentUser || btnSave.disabled) return;
Â Â Â Â Â Â Â Â btnSave.disabled = true;
Â Â Â Â Â Â Â Â btnSave.textContent = 'Mengunggah...';

Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â let uploadedUrls = { questionImage: null, questionAudio: null, optionImages: {} };
Â Â Â Â Â Â Â Â Â Â Â Â if(pendingUploads.questionImage) uploadedUrls.questionImage = await uploadToCloudinary(pendingUploads.questionImage, 'image');
Â Â Â Â Â Â Â Â Â Â Â Â if(pendingUploads.questionAudio) uploadedUrls.questionAudio = await uploadToCloudinary(pendingUploads.questionAudio, 'video');
Â Â Â Â Â Â Â Â Â Â Â Â for (const index in pendingUploads.optionImages) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const file = pendingUploads.optionImages[index];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â uploadedUrls.optionImages[index] = await uploadToCloudinary(file, 'image');
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â btnSave.textContent = 'Menyimpan...';

Â Â Â Â Â Â Â Â Â Â Â Â const data = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dibuatOleh: currentUser.uid,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dibuatPada: Timestamp.now(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â kategori: document.getElementById('kategori-pilihan').value || null,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â teksPertanyaan: document.getElementById('pertanyaan-teks').value.trim(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tipeSoal: tipeSoal.value,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â urlGambar: uploadedUrls.questionImage,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â urlSuara: uploadedUrls.questionAudio,
Â Â Â Â Â Â Â Â Â Â Â Â };

Â Â Â Â Â Â Â Â Â Â Â Â const t = tipeSoal.value;
Â Â Â Â Â Â Â Â Â Â Â Â if (t === 'pilihan_ganda') { /* ... no change ... */ } 
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'esai') {Â Â /* ... no change ... */ } 
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'pencocokan') {Â Â /* ... no change ... */ }
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'susun_kata') {Â Â /* ... no change ... */ }
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'multi_benar') {Â Â /* ... no change ... */ }
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'benar_salah') {Â Â /* ... no change ... */ }
Â Â Â Â Â Â Â Â Â Â Â Â else if (t === 'tts_mini') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const mendatar = document.getElementById('tts-mendatar').value.trim();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const menurun = document.getElementById('tts-menurun').value.trim();

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (!mendatar || !menurun) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â throw new Error("Jawaban mendatar dan menurun harus diisi.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // --- PERUBAHAN 4: Logika penyimpanan menggunakan fungsi baru ---
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const intersection = findIntersection(mendatar, menurun);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (!intersection) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Jika tidak ada huruf yang sama, lempar error
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â throw new Error("Jawaban mendatar dan menurun harus memiliki minimal satu huruf yang sama.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data.jawaban = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mendatar: mendatar,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â menurun: menurun,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mendatarIndex: intersection.mendatarIndex,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â menurunIndex: intersection.menurunIndex
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data.penjelasanTTS = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â semua_benar: document.getElementById('tts-reason').value.trim()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â const batch = writeBatch(db);
Â Â Â Â Â Â Â Â Â Â Â Â const questionRef = doc(collection(db, 'pertanyaan'));
Â Â Â Â Â Â Â Â Â Â Â Â batch.set(questionRef, data);
Â Â Â Â Â Â Â Â Â Â Â Â const creationLogRef = doc(db, 'userData', currentUser.uid, 'questionCreationTimestamp', questionRef.id);
Â Â Â Â Â Â Â Â Â Â Â Â batch.set(creationLogRef, { timestamp: Timestamp.now() });
Â Â Â Â Â Â Â Â Â Â Â Â await batch.commit();
Â Â Â Â Â Â Â Â Â Â Â Â showFormMessage('ok', 'Pertanyaan berhasil disimpan! ğŸš€');
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('question-form').reset();
Â Â Â Â Â Â Â Â Â Â Â Â pendingUploads = { questionImage: null, questionAudio: null, optionImages: {} };
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('file-image-name').textContent = 'Belum ada file dipilih';
Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('file-audio-name').textContent = 'Belum ada file dipilih';
Â Â Â Â Â Â Â Â Â Â Â Â renderDynamic();
Â Â Â Â Â Â Â Â Â Â Â Â await checkQuestionQuota(currentUser.uid);
Â Â Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â Â Â Â Â showFormMessage('err', err.message || 'Gagal menyimpan soal.');
Â Â Â Â Â Â Â Â } finally {
Â Â Â Â Â Â Â Â Â Â Â Â btnSave.disabled = false;
Â Â Â Â Â Â Â Â Â Â Â Â btnSave.textContent = 'Simpan Pertanyaan';
Â Â Â Â Â Â Â Â }
Â Â Â Â });

Â Â Â Â // --- Initial & Reset ---
Â Â Â Â renderDynamic();
Â Â Â Â tipeSoal.addEventListener('change', renderDynamic);
Â Â Â Â document.getElementById('btn-reset').addEventListener('click', ()=>{ 
Â Â Â Â Â Â Â Â document.getElementById('question-form').reset(); 
Â Â Â Â Â Â Â Â pendingUploads = { questionImage: null, questionAudio: null, optionImages: {} };
Â Â Â Â Â Â Â Â document.getElementById('file-image-name').textContent = 'Belum ada file dipilih';
Â Â Â Â Â Â Â Â document.getElementById('file-audio-name').textContent = 'Belum ada file dipilih';
Â Â Â Â Â Â Â Â renderDynamic(); 
Â Â Â Â });
</script>
</body>
</html>



