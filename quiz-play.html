<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waktunya Kuis! - Komunitas Ceria 2SD</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --blue-light: #e3f2fd; --blue-main: #0288d1; --green-correct: #4caf50; --red-wrong: #f44336; --orange-next: #ff9800; }
        body { font-family: 'Baloo 2', sans-serif; margin: 0; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 15px; box-sizing: border-box; }
        .quiz-container { position: relative; background-color: white; padding: 20px 30px 30px 30px; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 600px; text-align: center; }
        .btn-quit-quiz { position: absolute; top: 15px; right: 15px; background-color: #f1f1f1; color: #888; border: 2px solid #ddd; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 1.2rem; font-weight: 700; transition: all 0.2s ease; z-index: 10; }
        .btn-quit-quiz:hover { transform: scale(1.1) rotate(90deg); }
        .progress-container { margin-bottom: 15px; }
        .question-box { background-color: var(--blue-light); padding: 20px; border-radius: 15px; margin-bottom: 25px; min-height: 80px; display: flex; justify-content: center; align-items: center; border-left: 8px solid var(--blue-main); }
        .question-text { font-size: 1.8rem; font-weight: 800; color: var(--blue-main); margin: 0; }
        .answer-options { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .answer-btn { border: none; padding: 20px; border-radius: 15px; font-size: 1.5rem; font-family: 'Baloo 2', sans-serif; font-weight: 700; cursor: pointer; border-bottom: 6px solid; }
        .answer-btn.correct { background-color: var(--green-correct); color: white; border-color: #388e3c; animation: pulse 0.5s; }
        .answer-btn.wrong { background-color: var(--red-wrong); color: white; border-color: #c62828; }
        .feedback-box { margin-top: 20px; font-size: 1.8rem; font-weight: 800; min-height: 40px; }
        .next-btn { margin-top: 15px; background-color: var(--orange-next); color: white; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: 800; border-radius: 30px; cursor: pointer; visibility: hidden; border-bottom: 4px solid #f57c00; }
        .results-screen .btn { text-decoration: none; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 1.2rem; width: 100%; max-width: 300px; box-sizing: border-box; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }

        /* --- STYLE BARU UNTUK SUSUN HURUF --- */
        .susun-huruf-wrapper { margin-top: 15px; }
        .answer-slots-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-bottom: 25px; min-height: 60px; }
        .answer-slot { width: 50px; height: 60px; background-color: #e0e0e0; border-bottom: 5px solid #bdbdbd; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 2rem; font-weight: 800; }
        .letter-choices-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .letter-choice-btn { width: 55px; height: 55px; font-size: 1.8rem; background-color: #81d4fa; border: none; border-bottom: 5px solid #29b6f6; border-radius: 15px; font-family: 'Baloo 2', sans-serif; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .susun-huruf-actions { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .btn-action-word { background-color: #ffb74d; border: none; color: white; padding: 10px 25px; font-size: 1rem; border-radius: 20px; font-weight: 700; cursor: pointer; }
        .btn-check-word { background-color: #66bb6a; }
    </style>
</head>
<body>
    <div class="quiz-container">
        <!-- ... (konten tidak berubah) ... -->
    </div>

    <script type="module">
        // ... (konfigurasi Firebase dan deklarasi elemen tidak berubah) ...
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        // ... (fungsi loadQuiz, fetchQuestions, startQuiz tidak berubah) ...
        
        // --- PERUBAHAN UTAMA ADA DI FUNGSI DI BAWAH INI ---

        async function fetchQuestions(q) {
            const snapshot = await getDocs(q);
            let questions = [];
            for (const doc of snapshot.docs) {
                const data = doc.data();
                const type = data.tipeSoal || 'pilihan_ganda';
                if (type === 'pilihan_ganda') {
                    // ... (tidak berubah)
                } else if (type === 'esai') {
                    // ... (tidak berubah)
                } else if (type === 'susun_huruf') {
                    questions.push({ 
                        type, 
                        question: data.teksPertanyaan, 
                        answer: data.jawabanBenar 
                    });
                }
            }
            return questions;
        }

        function loadQuestion() {
            // ... (logika awal tidak berubah) ...
            if (currentQuestion.type === 'pilihan_ganda') {
                // ... (tidak berubah)
            } else if (currentQuestion.type === 'susun_huruf') {
                renderSusunHurufUI(currentQuestion);
            }
        }
        
                function renderSusunHurufUI(question) {
            // Mengosongkan kontainer jawaban sebelum merender yang baru
            answerOptions.innerHTML = '';

            const wrapper = document.createElement('div');
            wrapper.className = 'susun-huruf-wrapper';
            
            // Kontainer untuk slot jawaban yang akan diisi pemain
            const slotsContainer = document.createElement('div');
            slotsContainer.className = 'answer-slots-container';
            slotsContainer.id = 'slots-container';
            for (let i = 0; i < question.answer.length; i++) {
                slotsContainer.innerHTML += `<div class="answer-slot"></div>`;
            }

            // Kontainer untuk pilihan huruf yang tersedia
            const choicesContainer = document.createElement('div');
            choicesContainer.className = 'letter-choices-container';
            
            // Mengacak huruf dari jawaban dan menyimpannya sebagai array
            const letterChoices = shuffle(question.answer.split(''));

            // Membuat tombol untuk setiap huruf. Setiap tombol akan memiliki ID unik.
            letterChoices.forEach((letter, index) => {
                const btn = document.createElement('button');
                const btnId = `choice-btn-${index}`;
                btn.id = btnId;
                btn.textContent = letter;
                btn.className = 'letter-choice-btn';
                
                // Aksi saat tombol huruf diklik
                btn.onclick = () => {
                    // Cari slot kosong pertama
                    const emptySlot = slotsContainer.querySelector('.answer-slot:not(.filled)');
                    if (emptySlot) {
                        emptySlot.textContent = letter;
                        emptySlot.classList.add('filled');
                        // Simpan ID tombol yang diklik ke slot untuk referensi 'Hapus'
                        emptySlot.dataset.sourceBtnId = btnId;
                        // Sembunyikan tombol huruf yang sudah dipakai
                        btn.style.visibility = 'hidden';
                    }
                };
                choicesContainer.appendChild(btn);
            });

            // Kontainer untuk tombol aksi (Hapus & Periksa)
            const actions = document.createElement('div');
            actions.className = 'susun-huruf-actions';
            
            // Tombol untuk menghapus satu huruf dari slot jawaban
            const backspaceBtn = document.createElement('button');
            backspaceBtn.textContent = 'Hapus 1 Huruf';
            backspaceBtn.className = 'btn-action-word';
            backspaceBtn.onclick = () => {
                const filledSlots = slotsContainer.querySelectorAll('.answer-slot.filled');
                if (filledSlots.length > 0) {
                    const lastFilledSlot = filledSlots[filledSlots.length - 1];
                    const sourceBtnId = lastFilledSlot.dataset.sourceBtnId;
                    
                    // Jika ada referensi tombol sumber, tampilkan kembali tombol itu
                    if (sourceBtnId) {
                        const sourceBtn = document.getElementById(sourceBtnId);
                        if (sourceBtn) {
                            sourceBtn.style.visibility = 'visible';
                        }
                    }
                    
                    // Kosongkan slot terakhir
                    lastFilledSlot.textContent = '';
                    lastFilledSlot.classList.remove('filled');
                    delete lastFilledSlot.dataset.sourceBtnId;
                }
            };

            // Tombol untuk memeriksa jawaban akhir
            const checkBtn = document.createElement('button');
            checkBtn.textContent = 'Periksa Jawaban';
            checkBtn.className = 'btn-action-word btn-check-word';
            checkBtn.onclick = () => checkWordAnswer(question.answer);
            
            actions.append(backspaceBtn, checkBtn);
            
            wrapper.append(slotsContainer, choicesContainer, actions);
            answerOptions.appendChild(wrapper);
        }

        // --- Pastikan Anda memiliki fungsi shuffle ini ---
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

    </script>
</body>
</html>


