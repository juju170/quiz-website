<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buat Kuis Ceria - Untuk Guru Hebat!</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F0F9FF;
        }
        .form-container {
            background: white;
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            border: 2px solid #E0E7FF;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #D1D5DB;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #60A5FA;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
        }
        .label-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        .btn-simpan {
            background: linear-gradient(135deg, #34D399, #10B981);
            color: white;
            font-weight: 700;
            padding: 16px;
            border-radius: 9999px;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 211, 153, 0.4);
        }
        .btn-simpan:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 211, 153, 0.5);
        }
        .quiz-card {
            padding: 24px;
            border-radius: 20px;
            color: #1F2937;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .quiz-card:hover {
            transform: scale(1.05);
        }
        /* Sembunyikan fieldset spesifik secara default */
        .question-type-fields {
            display: none;
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600">Buat Kuis Baru yang Seru! ðŸš€</h1>
            <p class="text-gray-500 mt-2">Isi formulir di bawah untuk membuat kuis yang asyik bagi para siswa.</p>
        </header>

        <main id="form-kuis" class="form-container mb-12">
            <h2 class="text-2xl font-bold mb-6 text-gray-700">Detail Soal</h2>
            <form id="quizCreatorForm">
                 <div class="input-group">
                    <label for="judul" class="label-text"><i data-lucide="edit-3"></i>Judul Kuis (Topik)</label>
                    <input type="text" id="judul" class="input-field" placeholder="Contoh: Kuis Hewan Laut" required>
                </div>

                <div class="input-group">
                    <label for="pertanyaan" class="label-text"><i data-lucide="help-circle"></i>Teks Pertanyaan / Instruksi</label>
                    <textarea id="pertanyaan" rows="3" class="input-field" placeholder="Tuliskan pertanyaan atau instruksi pengerjaan soal..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="tipe-soal" class="label-text"><i data-lucide="list-checks"></i>Tipe Soal</label>
                    <select id="tipe-soal" class="input-field bg-white">
                        <option value="pilihan-ganda">1. Pilihan Ganda</option>
                        <option value="esai">2. Esai</option>
                        <option value="susun-huruf">3. Susun Huruf</option>
                        <option value="pencocokkan">4. Pencocokkan</option>
                        <option value="benar-salah">5. Benar atau Salah</option>
                        <option value="susun-kalimat">6. Susun Kata Jadi Kalimat</option>
                        <option value="tts-mini">7. Teka-Teki Silang Mini</option>
                    </select>
                </div>

                <!-- === FORM SPESIFIK UNTUK SETIAP TIPE SOAL === -->

                <!-- 1. Pilihan Ganda -->
                <fieldset id="fields-pilihan-ganda" class="question-type-fields space-y-4">
                    <label class="label-text"><i data-lucide="list"></i>Opsi Jawaban & Penjelasan</label>
                    <div id="pg-options-container">
                        <!-- Opsi akan ditambahkan oleh JS -->
                    </div>
                    <button type="button" id="add-pg-option-btn" class="text-sm text-blue-600 font-semibold flex items-center gap-2"><i data-lucide="plus-circle" class="w-4 h-4"></i>Tambah Opsi</button>
                    <div class="input-group">
                        <label for="pg-explanation" class="label-text"><i data-lucide="info"></i>Penjelasan Jawaban Benar</label>
                        <textarea id="pg-explanation" rows="2" class="input-field" placeholder="Jelaskan mengapa jawaban yang benar itu benar..."></textarea>
                    </div>
                </fieldset>

                <!-- 2. Esai -->
                <fieldset id="fields-esai" class="question-type-fields">
                     <div class="input-group">
                        <label for="esai-answer" class="label-text"><i data-lucide="key-round"></i>Kunci Jawaban Esai</label>
                        <textarea id="esai-answer" rows="3" class="input-field" placeholder="Tuliskan acuan jawaban benar untuk esai..."></textarea>
                    </div>
                </fieldset>

                <!-- 3. Susun Huruf -->
                <fieldset id="fields-susun-huruf" class="question-type-fields">
                     <div class="input-group">
                        <label for="susun-huruf-answer" class="label-text"><i data-lucide="key-round"></i>Jawaban (Kata yang Benar)</label>
                        <input type="text" id="susun-huruf-answer" class="input-field" placeholder="Contoh: INDONESIA">
                    </div>
                </fieldset>

                <!-- 4. Pencocokkan -->
                <fieldset id="fields-pencocokkan" class="question-type-fields space-y-4">
                    <label class="label-text"><i data-lucide="link-2"></i>Pasangan untuk Dicocokkan</label>
                    <div id="matching-pairs-container" class="space-y-3">
                        <!-- Pasangan akan ditambahkan oleh JS -->
                    </div>
                    <button type="button" id="add-matching-pair-btn" class="text-sm text-blue-600 font-semibold flex items-center gap-2"><i data-lucide="plus-circle" class="w-4 h-4"></i>Tambah Pasangan</button>
                </fieldset>

                <!-- 5. Benar atau Salah -->
                <fieldset id="fields-benar-salah" class="question-type-fields space-y-4">
                    <label class="label-text"><i data-lucide="check-circle-2"></i>Pilih Jawaban yang Benar</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-200 rounded-lg has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                            <input type="radio" name="bs-answer" value="Benar" class="h-4 w-4 text-blue-600">
                            <span>Benar</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border-2 border-gray-200 rounded-lg has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50">
                            <input type="radio" name="bs-answer" value="Salah" class="h-4 w-4 text-pink-600">
                            <span>Salah</span>
                        </label>
                    </div>
                </fieldset>
                
                <!-- 6. Susun Kata Jadi Kalimat -->
                <fieldset id="fields-susun-kalimat" class="question-type-fields">
                     <div class="input-group">
                        <label for="susun-kalimat-answer" class="label-text"><i data-lucide="key-round"></i>Kalimat Jawaban yang Benar</p></label>
                        <input type="text" id="susun-kalimat-answer" class="input-field" placeholder="Contoh: Ibu pergi ke pasar">
                    </div>
                    <div class="input-group">
                        <label class="label-text"><i data-lucide="list"></i>Opsi Kalimat Pengecoh</label>
                        <input type="text" name="kalimat-opsi" class="input-field mb-2" placeholder="Opsi pengecoh 1 (Contoh: Pasar pergi ke ibu)">
                        <input type="text" name="kalimat-opsi" class="input-field" placeholder="Opsi pengecoh 2 (Contoh: Ke pasar ibu pergi)">
                         <p class="text-xs text-gray-500 mt-1">Kalimat yang benar di atas akan otomatis diacak bersama opsi ini.</p>
                    </div>
                </fieldset>

                <!-- 7. TTS Mini -->
                 <fieldset id="fields-tts-mini" class="question-type-fields grid md:grid-cols-2 gap-6">
                     <div class="input-group">
                        <label for="tts-mendatar" class="label-text"><i data-lucide="arrow-right"></i>Jawaban Mendatar</label>
                        <input type="text" id="tts-mendatar" class="input-field" placeholder="Contoh: APEL">
                    </div>
                     <div class="input-group">
                        <label for="tts-menurun" class="label-text"><i data-lucide="arrow-down"></i>Jawaban Menurun</label>
                        <input type="text" id="tts-menurun" class="input-field" placeholder="Contoh: EMBUN">
                    </div>
                     <p class="text-xs text-gray-500 mt-1 md:col-span-2">Pastikan ada satu huruf yang sama antara kedua kata sebagai titik potong.</p>
                </fieldset>
                
                <div class="mt-8">
                    <button type="submit" class="btn-simpan flex items-center justify-center gap-2">
                        <i data-lucide="save"></i>
                        Simpan Soal ke Kuis
                    </button>
                </div>
            </form>
        </main>

        <section>
            <h2 class="text-3xl font-bold text-center mb-8 text-blue-600">Daftar Kuis yang Sudah Dibuat ðŸŽ¨</h2>
            <div id="daftar-kuis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p id="loading-quizzes" class="text-center text-gray-500 col-span-full">Memuat kuis...</p>
            </div>
        </section>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA6zXOerKvdPJTmBp5Y6R2yFsy98xLDsKc",
            authDomain: "forumwidara.firebaseapp.com",
            projectId: "forumwidara",
            storageBucket: "forumwidara.appspot.com",
            messagingSenderId: "216895655168",
            appId: "1:216895655168:web:59255f600fc3b3b44eb7e5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const quizzesCollectionRef = collection(db, 'quizzes');

        // --- ELEMEN DOM ---
        const form = document.getElementById('quizCreatorForm');
        const tipeSoalSelect = document.getElementById('tipe-soal');
        const daftarKuisContainer = document.getElementById('daftar-kuis');

        // --- FUNGSI UI ---
        
        function updateFormUI() {
            const selectedType = tipeSoalSelect.value;
            // Sembunyikan semua fieldset
            document.querySelectorAll('.question-type-fields').forEach(field => {
                field.style.display = 'none';
            });
            // Tampilkan fieldset yang sesuai
            const activeFieldset = document.getElementById(`fields-${selectedType}`);
            if (activeFieldset) {
                activeFieldset.style.display = 'block';
            }
        }
        
        // --- Fungsi Dinamis untuk Opsi Pilihan Ganda & Pencocokkan ---
        const pgContainer = document.getElementById('pg-options-container');
        const addPgBtn = document.getElementById('add-pg-option-btn');
        let pgOptionCount = 0;

        function addPgOption(isCorrect = false) {
            if (pgOptionCount >= 4) return;
            pgOptionCount++;
            const div = document.createElement('div');
            div.className = 'flex items-center gap-3 mb-2';
            div.innerHTML = `
                <input type="radio" name="pg-correct-option" value="${pgOptionCount}" class="h-5 w-5 text-blue-600" ${isCorrect ? 'checked' : ''}>
                <input type="text" class="input-field" name="pg-option-text" placeholder="Teks Opsi ${pgOptionCount} (bisa juga URL gambar)">
                <button type="button" class="remove-pg-option text-red-500 hover:text-red-700">&times;</button>
            `;
            pgContainer.appendChild(div);
            div.querySelector('.remove-pg-option').addEventListener('click', () => {
                div.remove();
                pgOptionCount--;
            });
        }
        addPgBtn.addEventListener('click', () => addPgOption());


        const matchingContainer = document.getElementById('matching-pairs-container');
        const addMatchingBtn = document.getElementById('add-matching-pair-btn');
        let matchingPairCount = 0;
        
        function addMatchingPair() {
            matchingPairCount++;
            const div = document.createElement('div');
            div.className = 'flex items-center gap-3';
            div.innerHTML = `
                <input type="text" class="input-field" name="matching-prompt" placeholder="Item Kiri ${matchingPairCount}">
                <span class="font-bold">=</span>
                <input type="text" class="input-field" name="matching-match" placeholder="Item Kanan ${matchingPairCount}">
                <button type="button" class="remove-matching-pair text-red-500 hover:text-red-700">&times;</button>
            `;
            matchingContainer.appendChild(div);
             div.querySelector('.remove-matching-pair').addEventListener('click', () => {
                div.remove();
                matchingPairCount--;
            });
        }
        addMatchingBtn.addEventListener('click', addMatchingPair);

        // --- FUNGSI DATA ---

        async function saveQuiz(e) {
            e.preventDefault();

            const title = document.getElementById('judul').value.trim();
            const questionText = document.getElementById('pertanyaan').value.trim();
            const type = tipeSoalSelect.value;

            if (!title || !questionText) {
                alert('Judul Kuis dan Teks Pertanyaan/Instruksi wajib diisi!');
                return;
            }
            
            let questionData = {
                question: questionText,
                type: type,
            };

            // Mengumpulkan data berdasarkan tipe soal
            switch (type) {
                case 'pilihan-ganda':
                    const options = [];
                    const optionElements = pgContainer.querySelectorAll('div');
                    const correctRadio = pgContainer.querySelector('input[name="pg-correct-option"]:checked');
                    if (!correctRadio) {
                        alert('Pilih salah satu jawaban yang benar untuk Pilihan Ganda!');
                        return;
                    }
                    const correctValue = correctRadio.value;

                    optionElements.forEach((opt, index) => {
                        const radio = opt.querySelector('input[type="radio"]');
                        const textInput = opt.querySelector('input[type="text"]');
                        if (textInput.value) {
                             options.push({
                                text: textInput.value.trim(),
                                isCorrect: radio.value === correctValue
                            });
                        }
                    });
                    questionData.options = options;
                    questionData.explanation = document.getElementById('pg-explanation').value.trim();
                    break;

                case 'esai':
                    questionData.answer = document.getElementById('esai-answer').value.trim();
                    break;
                
                case 'susun-huruf':
                    questionData.answer = document.getElementById('susun-huruf-answer').value.trim().toUpperCase();
                    break;
                
                case 'pencocokkan':
                    const pairs = [];
                    const pairElements = matchingContainer.querySelectorAll('div');
                    pairElements.forEach(pair => {
                        const prompt = pair.querySelector('input[name="matching-prompt"]').value.trim();
                        const match = pair.querySelector('input[name="matching-match"]').value.trim();
                        if (prompt && match) {
                            pairs.push({ prompt, match });
                        }
                    });
                    if (pairs.length < 2) {
                        alert('Tipe Pencocokkan membutuhkan minimal 2 pasang.');
                        return;
                    }
                    questionData.matchingPairs = pairs;
                    break;

                case 'benar-salah':
                    const bsAnswer = document.querySelector('input[name="bs-answer"]:checked');
                    if (!bsAnswer) {
                        alert('Pilih jawaban Benar atau Salah!');
                        return;
                    }
                    questionData.answer = bsAnswer.value === 'Benar'; // boolean true/false
                    break;

                case 'susun-kalimat':
                    const correctAnswer = document.getElementById('susun-kalimat-answer').value.trim();
                    if (!correctAnswer) {
                        alert('Isi kalimat jawaban yang benar!');
                        return;
                    }
                    const sentenceOptions = [correctAnswer];
                     document.querySelectorAll('input[name="kalimat-opsi"]').forEach(input => {
                        if (input.value.trim()) {
                            sentenceOptions.push(input.value.trim());
                        }
                    });
                    questionData.answer = correctAnswer;
                    questionData.sentenceOptions = sentenceOptions;
                    break;
                
                case 'tts-mini':
                    const horizontal = document.getElementById('tts-mendatar').value.trim().toUpperCase();
                    const vertical = document.getElementById('tts-menurun').value.trim().toUpperCase();
                     if (!horizontal || !vertical) {
                        alert('Isi jawaban mendatar dan menurun!');
                        return;
                    }
                    questionData.crossword = { horizontal, vertical };
                    br
